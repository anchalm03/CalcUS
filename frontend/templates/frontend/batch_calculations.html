{% extends 'frontend/base.html' %} 
{% load i18n %} 
{% load static %} 
{% block extrahead %}
<title>Batch Calculations</title>
    <script src="{% static 'frontend/jquery.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'frontend/ChemDoodleWeb.js' %}"></script>
    <script type="text/javascript" src="{% static 'frontend/uis/ChemDoodleWeb-uis.js' %}"></script>
    <link rel="stylesheet" href="{% static 'frontend/uis/jquery-ui-1.11.4.css' %}" type="text/css">
    <link rel="stylesheet" href="{% static 'frontend/form_style.css' %}" type="text/css">

    <script>
    {% include 'frontend/form/type_head.js' %} 
    {% include 'frontend/form/availability.js' %} 
    {% include 'frontend/form/file_upload_head.js' %} 
    </script>

    <script>
        var rowCounter = 1;
    
        function addRow() {
            rowCounter++;
            var inputRows = document.getElementById('input_rows');
            var newRow = document.createElement('div');
            newRow.classList.add('columns', 'is-vcentered');
            newRow.innerHTML = `
                <div class="column">
                    {% include "frontend/form/file_upload_body.html" with row_id=rowCounter %}
                </div>
                <div class="column">
                    {% include "frontend/form/charge_body.html" with row_id=rowCounter %}
                </div>
                <div class="column">
                    {% include "frontend/form/multiplicity_body.html" with row_id=rowCounter %}
                </div>
            `;
            inputRows.appendChild(newRow);
        }
    </script>

    <style>
        #input_files_div {
            max-width: 60em;
            text-align: center;
            margin-left: auto;
            margin-right: auto;
            margin-top: 4em;
        }

        #parameters_div {
            max-width: 60em;
            text-align: center;
            margin-left: auto;
            margin-right: auto;
            margin-top: 4em;
        }
        .column.is-8 {
            min-height: calc(3.0em + 1.5rem);
        }
        .field {
            margin-top: 0.25em !important;
            margin-bottom: 0.25em !important;
        }
        label.label {
            display: none;
        }
        
        .hidden_div {
            display: none;
        }

      
        .batch_name_input_container {
            display: flex;
            align-items: center;
        }
    
        .batch_name_label {
            margin-right: 10px; /* Adjust the spacing between the label and Batch Name as needed */
        }
    
        .batch_name {
            flex: auto ;
            border: 1px solid #ccc; /* Optional border style for Batch Name div */
            padding: 5px; /* Optional padding for Batch Name div */
            margin-right: 150px; /* Adjust the spacing between Batch Name and Preview button as needed */
        }
    
        /* Optional styling for the Preview button */
        .preview_button button {
            margin-left: 0;
        }
    
        
    
    
    
    
        
        
    </style>

{% endblock %} 

{% block content %} 
{% csrf_token %}

<div class="main_content" id="main_content">
     
    <div class="field" id="batch_name"> Batch Name
        <div class="control">
            <input class="input" name="batch_name" id="batch_name_input" type="text">
        </div>
    </div>

    <div class="field" id="calculation_type"> Calculation Type
        <div class="control">
            {% include 'frontend/form/type_body.html' %}   
        </div>
    </div>

    <div class="box" id="input_files_div"> 
        <div class="columns is-vcentered">
            <div class="column">
                <strong>Input Files</strong>
            </div>
            <div class="column">
                <strong>    Charge</strong>
            </div>
            <div class="column">
                <strong>Multiplicity</strong>
            </div>
        </div>
        
        <div id="input_rows">
            <div class="columns is-vcentered">
                <div class="column">
                    {% include "frontend/form/file_upload_body.html" with row_id=1 %}
                </div>
                <div class="column">
                    {% include "frontend/form/charge_body.html" with row_id=1 %}
                </div>
                <div class="column">
                    {% include "frontend/form/multiplicity_body.html" with row_id=1 %}
                </div>
            </div>
        </div>
        
        <button class="button is-primary" onclick="addRow()">Add</button>     
        
    </div>

    <div class="basic_form">
        {% include "frontend/basic_form.html"}
    </div>





    

    <div id="result_div" class="hidden_div">
            
        <!-- Batch Name in the previous div -->
        <div class="field" id="batch_name">
            <div class="control">
                <!-- Use a contenteditable div to show the Batch Name -->
                <div class="batch_name_input_container">
                    <div class="batch_name_label">Batch Name</div>
                    <div class="batch_name" id="batch_name_result" contenteditable="false" readonly></div>
                    <div class="preview_button">
                        <button class="button is-primary" onclick="previewBatch()">Preview</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="dynamic_form">
            {% include "frontend/dynamic_form.html"}
        </div>
    </div>


</div>




<script>
    function showResultDiv() {
        var mainContentDiv = document.getElementById("main_content");
        var resultDiv = document.getElementById("result_div");        
        mainContentDiv.classList.add("hidden_div");
        resultDiv.classList.remove("hidden_div");

        var batchName = document.getElementById("batch_name_input").value;
        document.getElementById("batch_name_result").textContent = batchName;

       
    }

    $(document).ready(function() {
        $('#params_form').submit(function(event) {
          event.preventDefault(); 

          
          var selectedFiles = [];
          $('input[name="files_to_include"]:checked').each(function() {
            selectedFiles.push($(this).val());
          });
      
          $.ajax({
            type: 'POST',
            url: '{% url 'process_form' %}',
            data: {
              'csrfmiddlewaretoken': '{{ csrf_token }}',
              'files_to_include': selectedFiles
            },
            success: function(response) {
              
                
              $('#dynamic_form').html(response);
              $('#dynamic_form').show();
            },
            error: function() {
              
                alert('An error occurred while processing the form.');
            }
          });
        });
      });



    
    $( document ).ready(function() {
	    refresh_availabilities();
    });
    var all_params = {};

	$('#params_form').submit(function () {
        data = new FormData(document.forms.namedItem("params_form"));
        all_params["test"] = data;
        showResultDiv(); 
        return false;
    });

</script>
{% endblock content %}
